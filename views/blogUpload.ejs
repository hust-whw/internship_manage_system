<!DOCTYPE html>
<html lang="en">

<head>
	<script src="/assets/plugins/jquery.js"></script>
	<!-- Basic -->
	<meta charset="UTF-8" />

	<title>日志上传</title>

	<!-- Mobile Metas -->
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

	<!-- Import google fonts -->
	<!--<link href='http://fonts.useso.com/css?family=Titillium+Web' rel='stylesheet' type='text/css'>-->

	<!-- Favicon and touch icons -->
	<!-- <link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon" /> -->
	<link rel="shortcut icon" href="/assets/ico/favicon.ico" type="image/x-icon" />
	<link rel="apple-touch-icon" href="/assets/ico/apple-touch-icon.png" />
	<link rel="apple-touch-icon" sizes="57x57" href="/assets/ico/apple-touch-icon-57x57.png" />
	<link rel="apple-touch-icon" sizes="72x72" href="/assets/ico/apple-touch-icon-72x72.png" />
	<link rel="apple-touch-icon" sizes="76x76" href="/assets/ico/apple-touch-icon-76x76.png" />
	<link rel="apple-touch-icon" sizes="114x114" href="/assets/ico/apple-touch-icon-114x114.png" />
	<link rel="apple-touch-icon" sizes="120x120" href="/assets/ico/apple-touch-icon-120x120.png" />
	<link rel="apple-touch-icon" sizes="144x144" href="/assets/ico/apple-touch-icon-144x144.png" />
	<link rel="apple-touch-icon" sizes="152x152" href="/assets/ico/apple-touch-icon-152x152.png" />

	<!-- start: CSS file-->
	<%- include('components/common-css') %>

	<link rel="stylesheet" type="text/css" href="/diyUpload/css/webuploader.css">
	<link rel="stylesheet" type="text/css" href="/diyUpload/css/diyUpload.css">

	<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=KmVaLtYGzplEZOk0Wvy3ZXHK"></script>

	<!-- end: CSS file-->	

	<!-- 加载高德地图 -->
	<link rel="stylesheet" href="http://cache.amap.com/lbs/static/main1119.css"/>
	<script src="http://cache.amap.com/lbs/static/es5.min.js"></script>

	<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
		<!--[if lt IE 9]>
			<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
			<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
			<![endif]-->

			<!--<script type="text/javascript" src="http://www.ip-look-up.com/Services/ipInfo.js"></script>--> 



			<style>
				#picGPS {
					width: 168px;
					height: 168px;                          
					background-position: center center;
					background-size: cover;
					border:none;

					display: inline-block;
				}
				#demo{ margin:50px auto; width:90%; min-height:400px; background:#CF9}
				/* *{ margin:0; padding:0;}*/
				#box{ margin:50px auto; width:90%; min-height:400px; background:#FF9}
			</style>

		</head>

		<body >

			<!-- Start: Header -->
			<div class="navbar" role="navigation">
				<div class="container-fluid container-nav">
					<!-- Navbar Action -->
					<ul class="nav navbar-nav navbar-actions navbar-left">
						<li class="visible-md visible-lg"><a href="#" id="main-menu-toggle"><i class="fa fa-th-large"></i></a></li>
						<li class="visible-xs visible-sm"><a href="#" id="sidebar-menu"><i class="fa fa-navicon"></i></a></li>			
					</ul>
					<!-- Navbar Left -->
					<div class="navbar-left">
						<!-- Search Form -->					
						<form class="search navbar-form">
							<div class="input-group input-search">
								<input type="text" class="form-control bk-radius" name="q" id="q" placeholder="Search...">
								<span class="input-group-btn">
									<button class="btn btn-default" type="submit"><i class="fa fa-search"></i></button>
								</span>
							</div>						
						</form>																	
					</div>
					<!-- Navbar Right -->
					<div class="navbar-right">					
						<%- include('components/notification') %>
					</div>
					<!-- End Navbar Right -->
				</div>		
			</div>
			<!-- End: Header -->

			<!-- Start: Content -->
			<div class="container-fluid content">	
				<div class="row">

					<%- include('components/side-bar') %>

					<!-- Main Page -->
					<div class="main ">
						<!-- Page Header -->
						<div class="page-header">
							<div class="pull-left">
								<ol class="breadcrumb visible-sm visible-md visible-lg">								
									<li><a href="#"><i class="icon fa fa-home"></i>主页</a></li>
									<li><a href="#"><i class="fa fa-list-alt"></i>工作日志管理</a></li>
									<li class="active"><i class="fa fa-tags"></i>上传工作日志</li>
								</ol>						
							</div>
							<div class="pull-right">
								<h2>上传工作日志</h2>
							</div>					
						</div>
						<!-- End Page Header -->


						<div class="row">
							<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
								<div class="panel panel-default form-wizard" id="w3">
									<div class="panel-heading">
										<h6><i class="fa fa-tags bk-fg-warning"></i>工作日志</h6>									
										<div class="panel-actions">
											<a href="#" class="btn-minimize"><i class="fa fa-caret-up"></i></a>

										</div>
									</div>
									<div class="panel-body">


										<div class="form-group">
											<div class="row">
												<div class="col-xs-12">
													<div class="panel panel-default">
														<div class="panel-heading bk-bg-white">
															<h6><i class="fa fa-edit red"></i>日志描述</h6>						
															<div class="panel-actions">
																<a href="#" class="btn-minimize"><i class="fa fa-caret-up"></i></a>

															</div>
														</div>						
														<div class="panel-body bk-bg-white bk-padding-top-30 bk-padding-bottom-20">

															<!-- <div class="form-group">
																<label class="col-sm-2 control-label" for="w3-studentID">教师ID</label>
																<div class="col-sm-8">
																	<input type="text" class="form-control input-sm" name="teacherID" id="teacherID"  value="584e8e191a372fa4f812f540" required>
																</div>
															</div>

															<div class="form-group">
																<label class="col-sm-2 control-label" for="inputSuccess">项目名称</label>
																<div class="col-sm-8">
																	<input type="text" class="form-control input-sm" name="cc-number" id="projectName" value="5844a612b79a594a836da29e" required>
																</div>
															</div> -->
															
															
															<div class="form-group">
																<label class="col-sm-2 control-label" for="inputSuccess">项目名称</label>
																<div id="select2-drop-mask" class="select2-drop-mask" style=""></div>
																<div class="col-sm-8">
																	<select  class="form-control input-sm" name="cc-number" id="projectName"> 
																		<% project.forEach(function(x){ %>

																		<option data-name="<%= x.Author.Name %>" value="<%= x._id %>"><%= x.Name %></option>
																		<% }); %> 
																		
																	</select>
																</div>
															</div>
															<br/>
															<div class="form-group">
																<label class="col-sm-2 control-label" for="w3-studentID">教师ID</label>
																<div class="col-sm-8">
																	<input type="text" class="form-control input-sm" name="teacherID" id="teacherName"  value="<%= project[0]?project[0].Author.Name:'没有参与任何项目或项目已归档，请联系管理员'%>" disabled>
																</div>
															</div>


															
															
														</div>
													</div>
												</div>
											</div>

											<div class="row">
												<div class="col-xs-12">
													<div class="panel panel-default">
														<div class="panel-heading bk-bg-white">
															<h6><i class="fa fa-edit red"></i>编辑内容</h6>						
															<div class="panel-actions">
																<a href="#" class="btn-minimize"><i class="fa fa-caret-up"></i></a>

															</div>
														</div>						
														<div class="panel-body bk-bg-white bk-padding-top-30 bk-padding-bottom-20 ">
															<!--<form class="form-horizontal form-bordered" method="get">-->
															<div class="form-group">									
																<div class="col-xs-12 col-lg-12 col-md-12 col-sm-12 ">
																	<textarea  rows="10" id="texts" name="contentments" placeholder="编辑文字" style="width:100%;"></textarea>
																</div>

															</div>
															<!--</form>-->
															<br /><br />
															<a  onclick="EV_modeAlert('envon')"><i class="fa fa-map-marker"></i>定位<span id="newGPS" style="margin-left:15px;"></span></a>
														</div>

													</div>

												</div>

											</div>
											<div class="row">
												<div class="col-lg-12">
													<div class="panel panel-default bk-bg-white">
														<div class="panel-heading bk-bg-white">
															<h6><i class="fa fa-picture-o "></i>上传图片</h6>
															<div class="panel-actions">
																<a href="#" class="btn-minimize"><i class="fa fa-caret-up"></i></a>
															</div>
														</div>
														<div class="panel-body">							  
															<div class="form-group">
																<!--<label class="control-label">Upload</label>-->
																<div class="controls" id="ppp">
																	<div id="dropzone">
																		<div id="box">
																			<div id="test" ></div>
																		</div>
																	</div>
																</div>
															</div>
														</div>
													</div>
												</div>
											</div>
										</div>

										<br />

										<div class="panel bk-widget bk-border-off">
											<div class="panel-body bk-ltr">
												<div class="row text-centerf">
													<button type="button" id="submit-all" class="btn btn-info btn-lg btn-block"> 提交</button>
												</div>
											</div>
										</div>		

									</div>
								</div>								
							</div>
						</div>

					</div>		
				</div>
				<!-- End Main Page -->
				<!-- 弹出高德地图-->
				<div id="envon" style=" width:90%; height:500px;background-color:#FFFFFF; border:1px solid #000000;margin-top:30px; padding:20px; overflow:hidden; display:none;">  
					<!--<a href="javascript:EV_closeAlert()">关闭</a>--> 
					<div class="panel-actions" style="margin-left:-20px;margin-right:-20px;margin-top:-20px;height:30px;background-color:blue;">
						<a href="#" class="pull-right" onclick="EV_closeAlert()"><i class="fa fa-times"></i></a>
						
					</div>
					<div id="container"  style="margin-top:30px;"></div>
					<div id="tip"></div>
				</div>  
				<!-- 弹出高德地图-->
				<!-- Footer -->

				<!-- End Footer -->

			</div>
		</div><!--/container-->		


		<!-- start: JavaScript-->
		<%- include('components/common-js') %>
		<script type="text/javascript" src="/diyUpload/js/webuploader.html5only.min.js"></script>
		<script type="text/javascript" src="/diyUpload/js/diyUpload.js"></script>


		<!-- end: JavaScript-->
	<script>
		$("#projectName").change(function(){
			$('#teacherName').val($(this).find("option:selected").attr('data-name'));
		});



		$('#submit-all').click(function(){
			if($('.fileBoxUl').length != 0)
				return false;
			var projectName=document.getElementById("projectName").value;

			if(projectName.toString()=="")
			{
				alert("没有参与任何项目或项目已归档，请联系管理员！");
				return false;
			}
			var text=document.getElementById("texts" ).value;
			var url =  "/blog/upload_text";
			var data={
				role:0,
				projectName:projectName,
				text:text
			};	

			$.ajax({ 
				url: url, 

				type: 'POST', 
				// contentType: 'application/x-www-form-urlencoded',
				data:data,
				success: function (returndata) { 

					if(returndata == '200'){
						alert("上传成功");
						window.location = "/blog/list"; 
					}

				}, 
				error: function (returndata) { 
					alert('上传失败，重新再试'); 
				} 
			});

		});


		$('#test').diyUpload({
			url:'/blog/upload',

			success: function (returndata) { 

				if(returndata == '201'){
					alert("上传成功");
					window.location = "/blog/list"; 
				}

			}, 
			error: function (returndata) { 
				alert('上传失败，重新再试'); 
			} 
		});

	</script>
	<script language="JavaScript" type="text/javascript"> 
		// 百度地图API功能
		var map = new BMap.Map("container",{doubleClickZoom: true,scrollWheelZoom:true,});
		var point = new BMap.Point(116.331398,39.897445);
			var mapPi=null;//存定位图
			var geoc = new BMap.Geocoder();   

			map.addControl(new BMap.NavigationControl());    
			map.addControl(new BMap.ScaleControl());    
			map.addControl(new BMap.OverviewMapControl());    
			map.addControl(new BMap.MapTypeControl()); 	
			var geolocation = new BMap.Geolocation();
			geolocation.getCurrentPosition(function(r){
				if(this.getStatus() == BMAP_STATUS_SUCCESS){
					var mk = new BMap.Marker(r.point);
					map.addOverlay(mk);
					map.panTo(r.point);
					point=r.point;
					//alert('您的位置：'+r.point.lng+','+r.point.lat);
					geoc.getLocation(r.point, function(rs){
						var addComp = rs.addressComponents;
						document.getElementById('newGPS').innerText=addComp.province + ", " + addComp.city + ", " + addComp.district + ", " + addComp.street + ", " + addComp.streetNumber;
						mapPic = "http://api.map.baidu.com/staticimage?center="+r.point.lng+","+r.point.lat+"&width=360&height=640&zoom=16&scale=2&markers="+r.point.lng+","+r.point.lat+"&markerStyles=l,";
					//alert(addComp.province + ", " + addComp.city + ", " + addComp.district + ", " + addComp.street + ", " + addComp.streetNumber);
					// alert(r.point.lat);
				});   
				}
				else {
					alert('failed'+this.getStatus());
				}        
			},{enableHighAccuracy: true});
			map.centerAndZoom(point,16);

		//---------------构造一个map对象-----------------------------------
		//|------------------------------------------------------------------------------------  
		//|  
		//| 说明：JS弹出全屏遮盖的对话框(弹出层后面有遮盖效果，兼容主流浏览器)  
		//|       实现了在最大化、拖动改变窗口大小和拖动滚动条时都可居中显示。  
		//|  
		//| 注意：主要使用EV_modeAlert和EV_closeAlert这两个函数行了；  
		//|       (EV_modeAlert-弹出对话框，EV_closeAlert-关闭对话框)；  
		//|       注意：使用时，请在body标签内(不要在其它元素内)写一div，  
		//|       再给这div赋一id属性，如：id="myMsgBox"，  
		//|       然后就可以调用EV_modeAlert('myMsgBox')来显示了。  
		//|       还有，请给你这div设置css：display:none让它在开始时不显示。  
		//|------------------------------------------------------------------------------------  
		//|  
		//用来记录要显示的DIV的ID值  
		var EV_MsgBox_ID=""; //重要  

		//弹出对话窗口(msgID-要显示的div的id)  
		function EV_modeAlert(msgID){  			
			//重新定位
			geolocation.getCurrentPosition(function(r){
				if(this.getStatus() == BMAP_STATUS_SUCCESS){
					var mk = new BMap.Marker(r.point);
					map.addOverlay(mk);
					map.panTo(r.point);
					point=r.point;
					//alert('您的位置：'+r.point.lng+','+r.point.lat);
					geoc.getLocation(r.point, function(rs){
						var addComp = rs.addressComponents;
						document.getElementById('newGPS').innerText=addComp.province + ", " + addComp.city + ", " + addComp.district + ", " + addComp.street + ", " + addComp.streetNumber;
						mapPic = "http://api.map.baidu.com/staticimage?center="+r.point.lng+","+r.point.lat+"&width=360&height=640&zoom=16&scale=2&markers="+r.point.lng+","+r.point.lat+"&markerStyles=l,";
					//alert(addComp.province + ", " + addComp.city + ", " + addComp.district + ", " + addComp.street + ", " + addComp.streetNumber);
				});   
				}
				else {
					alert('failed'+this.getStatus());
				}        
			},{enableHighAccuracy: true});

			//创建大大的背景框  
			var bgObj=document.createElement("div");  
			bgObj.setAttribute('id','EV_bgModeAlertDiv');  
			document.body.appendChild(bgObj);  
			//背景框满窗口显示  
			EV_Show_bgDiv();  
			//把要显示的div居中显示  
			EV_MsgBox_ID=msgID;  
			EV_Show_msgDiv();  
			//alert("jjj");
		}  

		//关闭对话窗口  
		function EV_closeAlert(){  
			var msgObj=document.getElementById(EV_MsgBox_ID);  
			var bgObj=document.getElementById("EV_bgModeAlertDiv");  
			msgObj.style.display="none";  
			document.body.removeChild(bgObj);  
			EV_MsgBox_ID="";  
		}  

		//窗口大小改变时更正显示大小和位置  
		window.onresize=function(){  
			if (EV_MsgBox_ID.length>0){  
				EV_Show_bgDiv();  
				EV_Show_msgDiv();  
			}  
		}  

		//窗口滚动条拖动时更正显示大小和位置  
		window.onscroll=function(){  
			if (EV_MsgBox_ID.length>0){  
				EV_Show_bgDiv();  
				EV_Show_msgDiv();  
			}  
		}  

		//把要显示的div居中显示  
		function EV_Show_msgDiv(){  
			var msgObj   = document.getElementById(EV_MsgBox_ID);  
			msgObj.style.display  = "block";  
			var msgWidth = msgObj.scrollWidth;  
			var msgHeight= msgObj.scrollHeight;  
			var bgTop=EV_myScrollTop();  
			var bgLeft=EV_myScrollLeft();  
			var bgWidth=EV_myClientWidth();  
			var bgHeight=EV_myClientHeight();  
			var msgTop=bgTop+Math.round((bgHeight-msgHeight)/2);  
			var msgLeft=bgLeft+Math.round((bgWidth-msgWidth)/2);  
			msgObj.style.position = "absolute";  
			msgObj.style.top      = msgTop+"px";  
			msgObj.style.left     = msgLeft+"px";  
			msgObj.style.zIndex   = "10001";  

		}  
		//背景框满窗口显示  
		function EV_Show_bgDiv(){  
			var bgObj=document.getElementById("EV_bgModeAlertDiv");  
			var bgWidth=EV_myClientWidth();  
			var bgHeight=EV_myClientHeight();  
			var bgTop=EV_myScrollTop();  
			var bgLeft=EV_myScrollLeft();  
			bgObj.style.position   = "absolute";  
			bgObj.style.top        = bgTop+"px";  
			bgObj.style.left       = bgLeft+"px";  
			bgObj.style.width      = bgWidth + "px";  
			bgObj.style.height     = bgHeight + "px";  
			bgObj.style.zIndex     = "10000";  
			bgObj.style.background = "#777";  
			bgObj.style.filter     = "progid:DXImageTransform.Microsoft.Alpha(style=0,opacity=60,finishOpacity=60);";  
			bgObj.style.opacity    = "0.6";  
		}  
		//网页被卷去的上高度  
		function EV_myScrollTop(){  
			var n=window.pageYOffset   
			|| document.documentElement.scrollTop   
			|| document.body.scrollTop || 0;  
			return n;  
		}  
		//网页被卷去的左宽度  
		function EV_myScrollLeft(){  
			var n=window.pageXOffset   
			|| document.documentElement.scrollLeft   
			|| document.body.scrollLeft || 0;  
			return n;  
		}  
		//网页可见区域宽  
		function EV_myClientWidth(){  
			var n=document.documentElement.clientWidth   
			|| document.body.clientWidth || 0;  
			return n;  
		}  
		//网页可见区域高  
		function EV_myClientHeight(){  
			var n=document.documentElement.clientHeight   
			|| document.body.clientHeight || 0;  
			return n;  
		}  
	</script>


	

</body>

</html>